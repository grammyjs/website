---
prev: ./getting-started.md
next: ./context.md
---

# Надсилання та отримання повідомлень

Після запуску бота за допомогою `bot.start()`, grammY надасть вашим обробникам повідомлення, які користувачі надсилають вашому боту, і ви легко зможете обробити їх за допомогою методів, наданих grammY.

## Отримання повідомлень

Найпростіший спосіб прослуховувати повідомлення через

```ts
bot.on("message", (ctx) => {
  const message = ctx.message; // об'єкт повідомлення
});
```

Однак також є низка інших варіантів.

```ts
// Оброблюємо команди, такі як /start.
bot.command("start", (ctx) => {/* ... */});

// Зіставляємо текст повідомлення з рядком або регулярним виразом.
bot.hears(/echo *(.+)?/, (ctx) => {/* ... */});
```

Ви можете скористатися автодоповненням у своєму редакторі коду, щоб побачити всі доступні параметри, або переглянути [всі методи](https://deno.land/x/grammy/mod.ts?s=Composer) класу `Composer`.

> [Докладніше](./filter-queries.md) про фільтрування певних типів повідомлень за допомогою `bot.on()`.

## Надсилання повідомлень

Усі методи, які можуть використовувати боти (**[важливий список](https://core.telegram.org/bots/api#available-methods)**), доступні в об’єкті `bot.api`.

```ts
// Надсилаємо текстове повідомлення користувачу з id 12345.
await bot.api.sendMessage(12345, "Агов!");
// За бажанням ми можемо передати об’єкт параметрів.
await bot.api.sendMessage(12345, "Агов!", {/* додаткові параметри */});

// Отримуємо інформацію про самого бота.
const me = await bot.api.getMe();

// тощо
```

Кожен метод приймає необов’язковий об’єкт параметрів типу `Other`, який дозволяє вам встановлювати додаткові параметри для викликів API.
Ці об’єкти параметрів точно відповідають параметрам, які ви можете знайти в списку методів, наведеному вище.
Ви також можете скористатися автодоповненням у своєму редакторі коду, щоб побачити всі доступні параметри, або переглянути [всі методи](https://deno.land/x/grammy/mod.ts?s=Api) класу `Api`.
Далі на цій сторінці показано кілька прикладів для цього.

Також перегляньте [наступний розділ](./context.md), щоб дізнатися, як контекстний об’єкт слухача робить надсилання повідомлень легким!

## Надсилання повідомлень із відповіддю

Ви можете скористатися методом відповіді Telegram, вказавши ідентифікатор повідомлення, на яке потрібно відповісти, за допомогою `reply_to_message_id`.

```ts
bot.hears("ping", async (ctx) => {
  // `reply` — це псевдонім для `sendMessage` у тому самому чаті (дивіться наступний розділ).
  await ctx.reply("pong", {
    // `reply_to_message_id` встановлює власне відповідь на повідомлення.
    reply_to_message_id: ctx.msg.message_id,
  });
});
```

> Зауважте, що надсилання повідомлення через `ctx.reply` **НЕ** означає, що ви автоматично встановлюєте відповідь на отримане повідомлення.
> Ви повинні вказати `reply_to_message_id` для цього.
> Метод `ctx.reply` — це лише псевдонім для `ctx.api.sendMessage`, дивіться [наступний розділ](./context.md#available-actions).

## Надсилання повідомлення з форматуванням

> Перегляньте [розділ про параметри форматування](https://core.telegram.org/bots/api#formatting-options) у довіднику Telegram Bot API, створеному командою Telegram.

Ви можете надсилати повідомлення **жирним шрифтом** або _курсивом_, використовувати URL-адреси тощо.
Є два способи зробити це, як описано в [розділі про параметри форматування](https://core.telegram.org/bots/api#formatting-options), а саме: Markdown і HTML.

### Markdown

> Також перегляньте <https://core.telegram.org/bots/api#markdownv2-style>

Надішліть своє повідомлення з розміткою Markdown в тексті та вкажіть `parse_mode: "MarkdownV2"`.

```ts
await bot.api.sendMessage(
  12345,
  "*Привіт\\!* _Ласкаво просимо_ до [grammY](https://grammy.dev)\\.",
  { parse_mode: "MarkdownV2" },
);
```

### HTML

> Також перегляньте <https://core.telegram.org/bots/api#html-style>

Надішліть своє повідомлення з елементами HTML у тексті та вкажіть `parse_mode: "HTML"`.

```ts
await bot.api.sendMessage(
  12345,
  '<b>Привіт!</b> <i>Ласкаво просимо</i> до <a href="https://grammy.dev">grammY</a>.',
  { parse_mode: "HTML" },
);
```

## Надсилання файлів

Обробка файлів пояснюється більш детально в [пізнішому розділі](./files.md#sending-files).

## Примусова відповідь

> Це може бути корисно, якщо ваш бот працює в [режимі конфіденційності](https://core.telegram.org/bots/features#privacy-mode) у групових чатах.

Коли ви надсилаєте повідомлення, ви можете зробити так, щоб клієнт Telegram користувача автоматично вказував відповідь на це повідомлення.
Це означає, що користувач автоматично відповість на повідомлення вашого бота, якщо він не видалить відповідь вручну.
Унаслідок цього ваш бот отримуватиме повідомлення користувача навіть під час роботи в [режимі конфіденційності](https://core.telegram.org/bots/features#privacy-mode) у групових чатах.

Ви можете примусово встановити відповідь наступним чином:

```ts
bot.command("start", async (ctx) => {
  await ctx.reply(
    "Привіт! Я можу читати лише ті повідомлення, у яких я маю відповідь!",
    // Зробіть так, щоб клієнти Telegram автоматично показували користувачеві інтерфейс відповіді.
    { reply_markup: { force_reply: true } },
  );
});
```
