# Хостинг: VPS

Віртуальний приватний сервер, відомий переважно як VPS, є віртуальною машиною, яка працює в хмарі, а користувачі мають повний контроль над її системою.

У цьому посібнику ви дізнаєтеся про різні методи запуску вашого бота на VPS, підтримання його в онлайні 24/7, автоматичний запуск при завантаженні вашого VPS і перезапуск при збоях.

## systemd

systemd --- це потужний менеджер служб, який передвстановлений у багатьох дистрибутивах Linux, переважно на основі Debian.

### Отримання команди запуску

1. Отримайте повний шлях до вашого середовища виконання:

```sh
# Якщо ви використовуєте Deno
which deno

# Якщо ви використовуєте Node.js
which node
```

2. Ви також повинні мати повний шлях до файлу, який є точкою входу вашого застосунку.

3. Ваша команда запуску повинна виглядати наступним чином:

```sh
<повний-шлях-до-середовища-виконання> <параметри> <повний-шлях-до-файлу-входу>

# Приклад для Deno:
# /home/user/.deno/bin/deno --allow-all /home/user/bot1/mod.ts

# Приклад для Node.js:
# /home/user/.nvm/versions/node/v16.9.1/bin/node /home/user/bot1/index.js
```

### Створення служби

1. Перейдіть до каталогу служб:

```sh
cd /etc/systemd/system
```

2. Відкрийте ваш новий файл служби за допомогою редактора:

```sh
nano bot1.service
```

3. Додайте наступний вміст:

```text
[Service]
ExecStart=<команда-запуску>
Restart=on-failure

[Install]
WantedBy=multi-user.target
```

> Замініть `<команда-запуску>` на команду, яку ви отримали вище.
>
> Також зверніть увагу, що якщо Deno встановлено для іншого користувача, а не root, вам може знадобитися додати `User=<імʼя-користувача>` в розділі `[Service]`.
> Для отримання додаткової інформації про файли служб відвідайте [цей сайт](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/assembly_working-with-systemd-unit-files_configuring-basic-system-settings).

3. Перезавантажуйте systemd кожного разу, коли ви редагуєте службу:

```sh
systemctl daemon-reload
```

### Управління службою

#### Запуск

```sh
systemctl start <назва-служби>
```

> Замініть `<назва-служби>` на назву файла служби, яку ви створили.
> Наприклад, `systemctl start bot1`

#### Запуск при завантаженні

```sh
systemctl enable <назва-служби>
```

#### Перегляд журналювання

```sh
systemctl status <назва-служби>
```

#### Перезавантаження

```sh
systemctl restart <назва-служби>
```

#### Зупинення

```sh
systemctl stop <назва-служби>
```

#### Вимкнення запуску при завантаженні

```sh
systemctl disable <назва-служби>
```

## PM2 (тільки для Node.js)

PM2 --- це менеджер демонів процесів для Node.js, який допоможе вам керувати та тримати ваш застосунок у режимі онлайн 24/7.

### Встановлення

```sh
npm install pm2@latest -g

# Якщо ви використовуєте Yarn
yarn global add pm2
```

### Управління застосунками

#### Старт

```sh
pm2 start --name <назва-застосунку> <файл-входу>
```

> `<назва-застосунку>` може бути будь-яким ідентифікатором для вашого застосунку: наприклад, `bot1`.
> `<файл-входу>` повинен бути шляхом до вашого файлу входу, який запускає вашого бота.

#### Перезапуск

Перезапуск застосунку передбачає його зупинку та повторний запуск.

```sh
pm2 restart <назва-застосунку>
```

#### Перезавантаження

Перезавантаження застосунку передбачає заміну поточного процесу вашого застосунку на новий, що призводить до відсутності перерви у роботі.
Це рекомендується для застосунків, які не мають стану.

```sh
pm2 reload <назва-застосунку>
```

#### Зупинка

```sh
# Для одного застосунку
pm2 stop <назва-застосунку>

# Для всіх застосунків
pm2 stop all
```

#### Видалення

При видаленні ви зупиняєте ваш застосунок та видаляєте всі логи та метрики.

```sh
pm2 del <назва-застосунку>
```

### Додаткова інформація

Для отримання додаткової інформації, будь ласка, відвідайте це посилання <https://pm2.keymetrics.io/docs/usage/quick-start>.
