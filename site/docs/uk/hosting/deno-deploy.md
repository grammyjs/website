# Хостинг: Deno Deploy

Цей посібник розповідає про способи, які дозволяють розмістити ваших ботів на grammY на [Deno Deploy](https://deno.com/deploy).

Зверніть увагу, що цей посібник призначений лише для користувачів Deno, а також для створення облікового запису на [Deno Deploy](https://deno.com/deploy) вам потрібно мати обліковий запис на [GitHub](https://github.com).

Deno Deploy ідеально підходить для більшості простих ботів, проте варто зазначити, що не всі функції Deno доступні для застосунків, що працюють на Deno Deploy.
Наприклад, платформа підтримує лише [обмежений набір](https://deno.com/deploy/docs/runtime-fs) API файлової системи, які доступні в Deno.
Це така ж платформа, як і багато інших безсерверних платформ, але призначена для застосунків на Deno.

Результат цього посібника [можна побачити в репозиторії з прикладами ботів](https://github.com/grammyjs/examples/tree/main/deno-deploy).

## Підготовка вашого коду

> Памʼятайте, що вам потрібно [запустити свого бота на вебхуках](../guide/deployment-types.md#як-використовувати-вебхуки), тому ви повинні використовувати `webhookCallback` і не викликати `bot.start()` у своєму коді.

1. Переконайтеся, що у вас є файл, який експортує ваш обʼєкт `Bot`, щоб ви могли імпортувати його пізніше для запуску.
2. Створіть файл з назвою `mod.ts` або `mod.js` або насправді будь-якою назвою, яку ви хочете, але ви повинні памʼятати та використовувати його як головний файл для розгортання, із наступним вмістом:

```ts
import { serve } from "https://deno.land/std/http/server.ts";
import { webhookCallback } from "https://deno.land/x/grammy/mod.ts";
// Ви можете змінити це на правильний спосіб імпорту вашого обʼєкта `Bot`.
import bot from "./bot.ts";

const handleUpdate = webhookCallback(bot, "std/http");

serve(async (req) => {
  if (req.method === "POST") {
    const url = new URL(req.url);
    if (url.pathname.slice(1) === bot.token) {
      try {
        return await handleUpdate(req);
      } catch (err) {
        console.error(err);
      }
    }
  }
  return new Response();
});
```

Ми радимо вам зареєструвати свій обробник на деякому секретному шляху, а не на кореневому (`/`).
В даному випадку ми використовуємо токен бота (`/<токен-бота>`) як секретний шлях.

## Розгортання

### 1-й метод: за допомогою GitHub

> Це рекомендований метод і найпростіший для використання.
> Основна перевага використання цього методу полягає в тому, що Deno Deploy буде стежити за змінами у вашому репозиторії, включаючи код вашого бота, і автоматично розгортатиме нові версії.

1. Створіть репозиторій на GitHub, він може бути як приватним, так і загальнодоступним.
2. Завантажте свій код.

> Рекомендується мати одну стабільну гілку, а тестувати свої напрацювання в інших гілках, щоб уникнути непередбачуваних помилок.

3. Відвідайте свою [панель керування Deno Deploy](https://dash.deno.com/projects).
4. Натисніть на "New Project" і перейдіть до розділу "Deploy from GitHub repository".
5. Встановіть GitHub-застосунок Deno Deploy на свій обліковий запис або організацію та виберіть свій репозиторій.
6. Виберіть гілку, яку ви хочете розгорнути, а потім виберіть файл `mod.ts` для розгортання.

### 2-й метод: за допомогою `deployctl`

> Це метод для більш досвідчених користувачів. Він дозволяє розгорнути проєкт за допомогою командного рядка або Github Actions.

1. Відвідайте свою [панель керування Deno Deploy](https://dash.deno.com/projects).
2. Натисніть на "New Project", а потім на "Empty Project".
3. Встановіть [`deployctl`](https://github.com/denoland/deployctl).
4. [Створіть токен доступу](https://dash.deno.com/user/access-tokens).
5. Виконайте наступну команду:

```sh
deployctl deploy --project <назва-проєкту> ./mod.ts --prod --token <токен-доступу>
```

6. Щоб налаштувати Github Actions, дивіться [це](https://github.com/denoland/deployctl/blob/main/action/README.md).

### 3-й метод: за допомогою URL

> Все, що вам потрібно зробити, щоб скористатися цим методом для розгортання вашого бота на grammY, — це отримати публічний URL-адрес вашого файлу `mod.ts`.

1. Створіть новий проєкт на Deno Deploy.
2. Натисніть на "Deploy URL".
3. Введіть загальнодоступну URL-адресу вашого файлу `mod.ts` і натисніть на "Deploy".

### Примітка

Після запуску застосунку вам потрібно налаштувати вебхук вашого бота так, щоб він вказував на URL-адресу вашого застосунку.
Для цього надішліть запит на адресу

```text
https://api.telegram.org/bot<токен-бота>/setWebhook?url=<адреса>
```

замінивши `<токен-бота>` на токен вашого бота, а `<адреса>` — на повну URL-адресу вашого застосунку разом з шляхом до обробника вебхуків.
