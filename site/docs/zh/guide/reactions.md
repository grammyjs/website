# ååº”

Bot å¯ä»¥å¤„ç†æ¶ˆæ¯ååº”
æœ‰ä¸¤ç§ç±»å‹çš„ååº”ï¼šemoji ååº”å’Œè‡ªå®šä¹‰ emoji ååº”ã€‚

## å¯¹æ¶ˆæ¯åšå‡ºååº”

Bot å¯ä»¥å‘æ¶ˆæ¯æ·»åŠ å•ä¸ª emoji ååº”ã€‚

åœ¨ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œbot ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ emoji åšå‡ºååº”ï¼ˆå³ä½¿ bot æ— æ³•æ‹¥æœ‰ [Telegram Premium](https://telegram.org/faq_premium?setln=en)ï¼‰ã€‚
å½“é«˜çº§ç”¨æˆ·å‘æ¶ˆæ¯æ·»åŠ è‡ªå®šä¹‰ emoji ååº”æ—¶ï¼Œbot ç¨åå¯ä»¥å‘è¯¥æ¶ˆæ¯æ·»åŠ ç›¸åŒçš„ååº”ã€‚
æ­¤å¤–ï¼Œå¦‚æœèŠå¤©ç®¡ç†å‘˜æ˜ç¡®å…è®¸ä½¿ç”¨è‡ªå®šä¹‰ emojiï¼Œåˆ™è¯¥èŠå¤©ä¸­çš„ bot ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚

ä»¥ä¸‹æ˜¯ä½ å¯ä»¥å¦‚ä½•å¯¹æ¶ˆæ¯åšå‡ºååº”ã€‚

```ts
// ä½¿ç”¨ `ctx.react` å¯¹å½“å‰æ¶ˆæ¯åšå‡ºååº”ã€‚
bot.command("start", (ctx) => ctx.react("ğŸ˜"));
bot.on("message", (ctx) => ctx.react("ğŸ‘"));

// ä½¿ç”¨ `ctx.api.setMessageReaction` å¯¹å…¶ä»–åœ°æ–¹çš„æ¶ˆæ¯åšå‡ºååº”ã€‚
bot.on("message", async (ctx) => {
  await ctx.api.setMessageReaction(chat_id, message_id, "ğŸ‰");
});

// åœ¨å¤„ç†ç¨‹åºå¤–çš„ä½¿ç”¨ `bot.api.setMessageReaction`ã€‚
await bot.api.setMessageReaction(chat_id, message_id, "ğŸ’¯");
```

ä¸å¾€å¸¸ä¸€æ ·ï¼ŒTypeScript å°†ä¸ºä½ å¯ä»¥ä½¿ç”¨çš„ emoji æä¾›è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ã€‚
å¯ç”¨ emoji ååº”çš„åˆ—è¡¨å¯ä»¥åœ¨ [æ­¤å¤„](https://core.telegram.org/bots/api#reactiontypeemoji) æ‰¾åˆ°ã€‚

::: tip Emoji æ’ä»¶
ä½¿ç”¨ emoji è¿›è¡Œç¼–ç¨‹å¯èƒ½ä¼šå¾ˆä¸‘é™‹ã€‚
å¹¶éæ‰€æœ‰ç³»ç»Ÿéƒ½å¯ä»¥æ­£ç¡®æ˜¾ç¤ºä½ çš„æºä»£ç ã€‚
è€Œä¸”ï¼Œæ€»æ˜¯ä»ä¸åŒçš„åœ°æ–¹å¤åˆ¶å®ƒä»¬ä¹Ÿå¾ˆçƒ¦äººã€‚

è®© [emoji æ’ä»¶](../plugins/emoji#æœ‰ç”¨çš„ååº”æ•°æ®) å¸®åŠ©ä½ ï¼
:::

ç°åœ¨ä½ å·²ç»çŸ¥é“ bot å¦‚ä½•å¯¹æ¶ˆæ¯åšå‡ºååº”ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¤„ç†ç”¨æˆ·çš„ååº”ã€‚

## æ¥æ”¶æœ‰å…³ååº”çš„ Update

æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥å¤„ç†æœ‰å…³ååº”çš„ updateã€‚
åœ¨ç§èŠå’Œç¾¤èŠä¸­ï¼Œå¦‚æœç”¨æˆ·æ›´æ”¹äº†å¯¹æ¶ˆæ¯çš„ååº”ï¼Œä½ çš„ bot å°†æ”¶åˆ° `message_reaction` updateã€‚
åœ¨é¢‘é“ï¼ˆè‡ªåŠ¨è½¬å‘åˆ°ç¾¤èŠä¸­çš„é¢‘é“å¸–å­ï¼‰ä¸­ï¼Œä½ çš„ bot å°†æ”¶åˆ° `message_reaction_count` updateï¼Œè¯¥ update ä»…æ˜¾ç¤ºååº”æ€»æ•°ï¼Œä½†ä¸ä¼šé€éœ²è°åšå‡ºäº†ååº”ã€‚

è¿™ä¸¤ç§ç±»å‹çš„ååº”éƒ½éœ€è¦å…ˆå¯ç”¨æ‰èƒ½æ¥æ”¶ã€‚
ä¾‹å¦‚ï¼Œé€šè¿‡å†…ç½®è½®è¯¢ï¼Œä½ å¯ä»¥åƒè¿™æ ·å¯ç”¨å®ƒä»¬ï¼š

```ts
bot.start({
  allowed_updates: ["message", "message_reaction", "message_reaction_count"],
});
```

::: tip å¯ç”¨æ‰€æœ‰ update ç±»å‹
ä½ éœ€è¦ä» grammY å¯¼å…¥ `API_CONSTANTS`ï¼Œç„¶åè®¾ç½®

```ts
allowed_updates: API_CONSTANTS.ALL_UPDATE_TYPES;
```

æ¥æ¥æ”¶æ‰€æœ‰ updateã€‚
è¯·åŠ¡å¿…æŸ¥çœ‹ [API å‚è€ƒ](/ref/core/apiconstants#all-update-types)ã€‚
:::

[grammY runner](../plugins/runner#é«˜çº§é€‰é¡¹) å’Œ `setWebhook` æœ‰ç€ç›¸åŒçš„æ–¹å¼æ¥è®¾ç½® `allowed_updates`ã€‚

ç°åœ¨ä½ çš„ bot å¯ä»¥æ¥æ”¶ååº” updateï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å¤„ç†å®ƒä»¬çš„ï¼

### å¤„ç†æ–°çš„ååº”

å¤„ç†æ–°æ·»åŠ çš„ååº”éå¸¸ç®€å•ã€‚
grammY é€šè¿‡ `bot.reaction` å¯¹æ­¤æä¾›äº†ç‰¹æ®Šæ”¯æŒã€‚

```ts
bot.reaction("ğŸ‰", (ctx) => ctx.reply("å‘œå‘¼~"));
bot.reaction(["ğŸ‘", "ğŸ‘"], (ctx) => ctx.reply("æ¼‚äº®çš„å¤§æ‹‡æŒ‡"));
```

æ¯å½“ç”¨æˆ·å‘æ¶ˆæ¯æ·»åŠ æ–°çš„ emoji ååº”æ—¶ï¼Œè¿™äº›å¤„ç†ç¨‹åºå°±ä¼šè§¦å‘ã€‚

å½“ç„¶ï¼Œå¦‚æœä½ çš„ bot å¯ä»¥å¤„ç†é«˜çº§ç”¨æˆ·çš„è‡ªå®šä¹‰ emoji ååº”ï¼Œä½ ä¹Ÿå¯ä»¥ç›‘å¬å®ƒä»¬ã€‚

```ts
bot.reaction(
  { type: "custom_emoji", custom_emoji_id: "identifier-string" },
  async (ctx) => {/* ... */},
);
```

è¿™å°±éœ€è¦ä½ æå‰çŸ¥é“è‡ªå®šä¹‰ emoji çš„æ ‡è¯†ç¬¦ã€‚

### å¤„ç†ä»»æ„å˜åŒ–çš„ååº”

å°½ç®¡è¿™åœ¨ä»»ä½•å®˜æ–¹ Telegram å®¢æˆ·ç«¯çš„ UI ä¸­éƒ½ä¸å¯è§ï¼Œä½†ç”¨æˆ·å®é™…ä¸Šå¯ä»¥ä¸€æ¬¡æ›´æ”¹å¤šä¸ªååº”ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆååº” update ä¼šä¸ºä½ æä¾›ä¸¤ä¸ªåˆ—è¡¨ï¼šæ—§ååº”å’Œæ–°ååº”ã€‚
è¿™å…è®¸ä½ çš„ bot å¤„ç†å¯¹ååº”åˆ—è¡¨çš„ä»»æ„æ›´æ”¹ã€‚

```ts
bot.on("message_reaction", async (ctx) => {
  const reaction = ctx.messageReaction;
  // æˆ‘ä»¬åªæ¥æ”¶æ¶ˆæ¯æ ‡è¯†ç¬¦ï¼Œè€Œä¸æ¥æ”¶æ¶ˆæ¯å†…å®¹ã€‚
  const message = reaction.message_id;
  // è¿™ä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´çš„å·®å¼‚å±•ç¤ºäº†å˜åŒ–ã€‚
  const old = reaction.old_reaction; // ä¹‹å‰çš„
  const now = reaction.new_reaction; // å½“å‰çš„
});
```

grammY å…è®¸ä½ ä½¿ç”¨é’ˆå¯¹ååº”ç±»å‹çš„ç‰¹æ®Šçš„ [filter æŸ¥è¯¢](./filter-queries) è¿›ä¸€æ­¥è¿‡æ»¤ updateã€‚

```ts
// å½“å‰çš„ååº”è‡³å°‘åŒ…å«ä¸€ä¸ª emoji çš„ updateã€‚
bot.on("message_reaction:new_reaction:emoji", (ctx) => {/* ... */});
// ä¹‹å‰çš„ååº”è‡³å°‘åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰ emoji çš„ updateã€‚
bot.on("message_reaction:old_reaction:custom_emoji", (ctx) => {/* ... */});
```

è™½ç„¶è¿™ä¸¤ä¸ª [`ReactionType` å¯¹è±¡](https://core.telegram.org/bots/api#reactiontype) æ•°ç»„åœ¨æŠ€æœ¯ä¸Šä¸ºä½ æä¾›äº†å¤„ç†ååº” update æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä½†å®ƒä»¬ç”¨èµ·æ¥ä»ç„¶æœ‰ç‚¹éº»çƒ¦ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ grammY å¯ä»¥ä» update ä¸­è®¡ç®—å‡ºæ›´å¤šæœ‰ç”¨çš„ä¸œè¥¿ã€‚

### æŸ¥çœ‹ååº”å¦‚ä½•å˜åŒ–

æœ‰ä¸€ä¸ªåä¸º `ctx.reactions` çš„ [ä¸Šä¸‹æ–‡å¿«æ·æ–¹å¼](./context#å¿«æ·æ–¹å¼)ï¼Œå¯è®©ä½ æŸ¥çœ‹ååº”åˆ°åº•æ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚

ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ `ctx.reactions` æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦å–æ¶ˆäº†ä»–ä»¬çš„ç‚¹èµï¼ˆä½†å¦‚æœä»–ä»¬ä»ç„¶ä¿æŒokæ‰‹åŠ¿ååº”ï¼Œåˆ™åŸè°…ä»–ä»¬ï¼‰ã€‚

```ts
bot.on("message_reaction", async (ctx) => {
  const { emoji, emojiAdded, emojiRemoved } = ctx.reactions();
  if (emojiRemoved.includes("ğŸ‘")) {
    // ç‚¹èµå·²è¢«åˆ é™¤ï¼ä¸å¯æ¥å—ã€‚
    if (emoji.includes("ğŸ‘Œ")) {
      // è¿˜æ˜¯å¯ä»¥çš„ï¼Œä¸å¤„ç½š
      await ctx.reply("æˆ‘åŸè°…ä½ ");
    } else {
      // ä»–ä»¬æ€ä¹ˆæ•¢çš„ï¼Œç»™ä¸«å°äº†ã€‚
      await ctx.banAuthor();
    }
  }
});
```

`ctx.reaction` è¿”å›å››ä¸ªæ•°ç»„ï¼šæ·»åŠ çš„ emojiã€åˆ é™¤çš„ emojiã€ä¿ç•™çš„emojiï¼Œä»¥åŠä¸€ä¸ªå‘Šè¯‰ä½ æ›´æ”¹ç»“æœçš„åˆ—è¡¨ã€‚
æ­¤å¤–ï¼Œè¿˜æœ‰å››ä¸ªå…·æœ‰ç±»ä¼¼ä¿¡æ¯çš„è‡ªå®šä¹‰ emoji æ•°ç»„ã€‚

```ts
const {
  /** å½“å‰å­˜åœ¨åœ¨è¯¥ç”¨æˆ·çš„ååº”ä¸­çš„ emoji */
  emoji,
  /** æ–°æ·»åŠ äº†åˆ°è¯¥ç”¨æˆ·çš„ååº”ä¸­çš„ emoji */
  emojiAdded,
  /** æœªå› è¯¥ç”¨æˆ·ååº”çš„ update è€Œæ”¹å˜çš„ emoji */
  emojiKept,
  /** ä»è¯¥ç”¨æˆ·çš„ååº”ä¸­ç§»é™¤çš„ emoji */
  emojiRemoved,
  /** å½“å‰å­˜åœ¨åœ¨è¯¥ç”¨æˆ·çš„ååº”ä¸­çš„è‡ªå®šä¹‰ emoji */
  customEmoji,
  /** æ–°æ·»åŠ äº†åˆ°è¯¥ç”¨æˆ·çš„ååº”ä¸­çš„è‡ªå®šä¹‰ emoji */
  customEmojiAdded,
  /** æœªå› è¯¥ç”¨æˆ·ååº”çš„ update è€Œæ”¹å˜çš„è‡ªå®šä¹‰ emoji */
  customEmojiKept,
  /** ä»è¯¥ç”¨æˆ·çš„ååº”ä¸­ç§»é™¤çš„è‡ªå®šä¹‰ emoji */
  customEmojiRemoved,
} = ctx.reactions();
```

å…³äºå¤„ç†ç§èŠå’Œç¾¤èŠä¸­çš„ update å·²ç»è¯´äº†å¾ˆå¤šã€‚
æˆ‘ä»¬æ¥çœ‹çœ‹é¢‘é“ã€‚

### å¤„ç†ååº”è®¡æ•° Update

åœ¨ç§èŠã€ç¾¤ç»„å’Œè¶…çº§ç¾¤ç»„ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“è°å¯¹å“ªæ¡æ¶ˆæ¯åšå‡ºååº”ã€‚
ä½†æ˜¯ï¼Œå¯¹äºé¢‘é“å¸–å­ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåŒ¿åçš„ååº”åˆ—è¡¨ã€‚
æˆ‘ä»¬æ— æ³•è·å–å¯¹æŸä¸ªå¸–å­åšå‡ºååº”çš„ç”¨æˆ·åˆ—è¡¨ã€‚
è‡ªåŠ¨è½¬å‘åˆ°è®¨è®ºç»„èŠå¤©çš„é¢‘é“å¸–å­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä½ çš„ bot éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ª `message_reaction_count` updateã€‚

ä½ å¯ä»¥è¿™æ ·å¤„ç†å®ƒã€‚

```ts
bot.on("message_reaction_count", async (ctx) => {
  const counts = ctx.messageReactionCount;
  // åŒæ ·ï¼Œæˆ‘ä»¬åªèƒ½çœ‹åˆ°æ¶ˆæ¯æ ‡è¯†ç¬¦ã€‚
  const message = counts.message_id;
  // è¿™æ˜¯å¸¦æœ‰è®¡æ•°çš„ååº”åˆ—è¡¨ã€‚
  const { reactions } = counts;
});
```

è¯·åŠ¡å¿…æŸ¥çœ‹ [è§„èŒƒ](https://core.telegram.org/bots/api#messagereactioncountupdated) ä»¥è·å–æ¶ˆæ¯ååº”è®¡æ•° updateã€‚
