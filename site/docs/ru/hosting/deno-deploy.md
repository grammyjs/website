---
prev: false
next: false
---

# Хостинг: Deno Deploy

В этом руководстве рассказывается о том, как вы можете разместить своих ботов grammY на [Deno Deploy](https://deno.com/deploy).

Обратите внимание, что это руководство предназначено только для пользователей Deno, и для создания учетной записи [Deno Deploy](https://deno.com/deploy) вам необходимо иметь аккаунт [GitHub](https://github.com).

Deno Deploy идеально подходит для большинства простых ботов, но следует учитывать, что не все функции Deno доступны для приложений, работающих на Deno Deploy.
Например, платформа поддерживает только [ограниченный набор](https://docs.deno.com/deploy/api/runtime-fs) API файловой системы, доступных в Deno.
Она похожа на другие многочисленные бессерверные платформы, но предназначена для приложений Deno.

Результат этого руководства [можно увидеть в нашем примере репозитория ботов](https://github.com/grammyjs/examples/tree/main/setups/deno-deploy).

## Подготовка кода

> Помните, что вам нужно [запускать бота на вебхукам](../guide/deployment-types#как-использовать-вебхуки), поэтому в коде следует использовать `webhookCallback`, а не вызывать `bot.start()`.

1. Убедитесь, что у вас есть файл, который экспортирует ваш объект `Bot`, чтобы вы могли импортировать его позже для запуска.
2. Создайте файл с именем `mod.ts` или `mod.js`, или вообще любым другим именем, которое вам нравится (но вы должны запомнить и использовать его как основной файл для развертывания), со следующим содержимым:

```ts
import { webhookCallback } from "https://deno.land/x/grammy/mod.ts";
// Вы можете изменить это, чтобы правильно импортировать свой объект `Bot`.
import bot from "./bot.ts";

const handleUpdate = webhookCallback(bot, "std/http");

Deno.serve(async (req) => {
  if (req.method === "POST") {
    const url = new URL(req.url);
    if (url.pathname.slice(1) === bot.token) {
      try {
        return await handleUpdate(req);
      } catch (err) {
        console.error(err);
      }
    }
  }
  return new Response();
});
```

Мы советуем располагать обработчик не в корне (`/`), а по какому-то секретному пути.
Здесь мы используем токен бота (`/<токен>`).

## Развертывание

### Метод 1: через GitHub

> Это рекомендуемый и самый простой метод.
> Основное преимущество этого метода заключается в том, что Deno Deploy будет следить за изменениями в вашем репозитории, включающем код вашего бота, и автоматически развертывать новые версии.

1. Создайте репозиторий на GitHub, он может быть как приватным, так и публичным.
2. Разместите свой код.

   > Рекомендуется иметь одну стабильную ветку, а тестирование проводить в других ветках, чтобы не случилось непредвиденных ситуаций.

3. Зайдите на свою панель [Deno Deploy dashboard](https://dash.deno.com/projects).
4. Нажмите на "New Project" и перейдите в раздел "Deploy from GitHub repository".
5. Установите подключение на свой аккаунт или организацию и выберите репозиторий.
6. Выберите ветку, которую вы хотите развернуть, а затем выберите файл `mod.ts` для развертывания.

### Метод 2: с помощью `deployctl`

> Это метод для более продвинутых пользователей. Он позволяет развернуть проект через командную строку или Github Actions.

1. Зайдите на свою панель [Deno Deploy dashboard](https://dash.deno.com/projects).
2. Нажмите "New Project", а затем "Empty Project".
3. Установите [`deployctl`](https://github.com/denoland/deployctl).
4. [Создайте токен для доступа](https://dash.deno.com/account).
5. Выполните следующую команду:

   ```sh
   deployctl deploy --project <проект> ./mod.ts --prod --token <токен>
   ```

6. Чтобы настроить Github Actions, обратитесь к [этому README](https://github.com/denoland/deployctl/blob/main/action/README.md).

### Метод 3: через URL

> Все, что вам нужно для развертывания вашего бота grammY по этому методу --- это публичный URL-адрес вашего файла `mod.ts`.

1. Создайте новый проект в Deno Deploy.
2. Нажмите "Deploy URL".
3. Введите публичный URL-адрес вашего файла `mod.ts` и нажмите "Deploy".

### Примечание

После запуска приложения необходимо настроить параметры вебхука бота так, чтобы он указывал на вашего бота.
Для этого отправьте запрос на

```text
https://api.telegram.org/bot<токен>/setWebhook?url=<url>
```

заменив `<токен>` на токен вашего бота, а `<url>` на полный URL вашего приложения вместе с путем к обработчику webhook.
